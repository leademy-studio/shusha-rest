# Синхронизация меню

## Проблема и решение

### Проблема
API `/api/catalog` возвращал ошибку из-за недоступных terminal groups в iiko API, но реальное меню ресторана было экспортировано из iiko в файл.

### Решение
Создан механизм фоллбэка на статическое меню:
1. Экспортировано полное меню из iiko API (117 товаров)
2. Отфильтрованы активные товары (94 позиции)
3. Создан `static-menu.json` для использования как фоллбэк
4. Обновлен сервер для автоматического переключения на статическое меню

## Файлы

### Созданные
- `static-menu.json` - статическое меню с 94 товарами
- `export_menu.py` - скрипт для экспорта меню из iiko API
- `menu_export_20251230_110102.json` - полный экспорт из iiko (117 товаров)
- `menu_export.csv` - экспорт в CSV формате

### Обновленные
- `server.js` - добавлена логика фоллбэка на статическое меню
- `assets/js/catalog.js` - умные плейсхолдеры, бейджи категорий, описания
- `assets/css/catalog.css` - стили скелетонов и новых элементов
- `assets/css/popular.css` - улучшенные стили карточек

## Статистика меню

```
✅ Всего товаров: 94
✅ Категорий: 13
✅ С изображениями: 62 (66%)
✅ С описаниями: 15 (16%)
```

### Категории:
- Прохладительные напитки (5)
- Выпечка (7)
- Гарниры (3)
- Горячие блюда (6)
- Горячие закуски (2)
- Десерты (7)
- Закуски к пиву (2)
- **Мангал (15)** ⭐
- Салаты (8)
- **Соусы (18)** ⭐
- Супы (6)
- Хинкали (4)
- Холодные закуски (11)

## Функции отображения

✓ **Умные плейсхолдеры** - каждая категория имеет тематическое изображение  
✓ **Бейджи категорий** - полупрозрачные бейджи на карточках  
✓ **Описания блюд** - отображаются там, где доступны (15 позиций)  
✓ **Скелетоны загрузки** - анимация при загрузке меню  
✓ **Фильтрация** - по всем 13 категориям  
✓ **Реальные изображения** - из iiko для 62 товаров  
✓ **Микроразметка** - Schema.org Product  
✓ **Адаптивность** - мобильные, планшеты, десктоп  

## Использование

### Просмотр каталога
```bash
# Откройте в браузере
http://localhost:3000/catalog
```

### API
```bash
# Получить все товары
curl http://localhost:3000/api/catalog

# Результат содержит:
# - items: массив товаров (94 шт)
# - organizationId: ID ресторана
# - terminalGroupId: ID терминала
```

### Обновление меню из iiko
```bash
# Экспортировать свежее меню
python3 export_menu.py

# Преобразовать в static-menu.json
# (используйте скрипт из MENU_SYNC.md)
```

## Логика работы сервера

```javascript
1. Попытка загрузить из iiko API
   ├─ Успех → возврат данных из iiko
   └─ Ошибка → переход к шагу 2

2. Загрузка static-menu.json
   ├─ Файл найден → возврат статического меню
   └─ Файл не найден → ошибка 500
```

## Преимущества подхода

1. **Надежность** - сайт работает даже при проблемах с iiko API
2. **Актуальность** - можно периодически обновлять static-menu.json
3. **Производительность** - статическое меню загружается быстрее
4. **Гибкость** - легко добавить кеширование или CDN

## Дальнейшие улучшения

- [ ] Автоматическое обновление static-menu.json по расписанию
- [ ] Кеширование ответов iiko API
- [ ] Админ-панель для управления меню
- [ ] Загрузка изображений на CDN
- [ ] Мультиязычность меню
